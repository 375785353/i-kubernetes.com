


<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>kube-prometheus - kubernetes学习之路</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="" data-md-color-primary="teal" data-md-color-accent="green">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kube-prometheus" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="">
    <a href="../.." title="kubernetes学习之路" class="md-header-nav__button md-logo" aria-label="kubernetes学习之路">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            kubernetes学习之路
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              kube-prometheus
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

<nav class="md-tabs" aria-label="" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../kubernetes/01.cobbler%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/" class="md-tabs__link">
          kubernetes
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../prometheus/" class="md-tabs__link">
          prometheus
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../mkdocs/" class="md-tabs__link">
          mkdocs
        </a>
      
    </li>
  

  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="kubernetes学习之路" class="md-nav__button md-logo" aria-label="kubernetes学习之路">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    kubernetes学习之路
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      kubernetes
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="kubernetes" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kubernetes/01.cobbler%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/" title="01.cobbler自动化部署" class="md-nav__link">
      01.cobbler自动化部署
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      prometheus
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="prometheus" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        prometheus
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../prometheus/" title="Prometheus简介" class="md-nav__link">
      Prometheus简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dashboard/" title="dashboard模板" class="md-nav__link">
      dashboard模板
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      mkdocs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="mkdocs" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        mkdocs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      mkdocs介绍
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="mkdocs介绍" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        mkdocs介绍
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/" title="1. 本文主题" class="md-nav__link">
      1. 本文主题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/view/what/" title="2. mkdocs-material介绍" class="md-nav__link">
      2. mkdocs-material介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/view/statement/" title="3. 提前说明" class="md-nav__link">
      3. 提前说明
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/view/bestpractice/" title="4. 最佳实践" class="md-nav__link">
      4. 最佳实践
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/view/contact/" title="5. 联系方式" class="md-nav__link">
      5. 联系方式
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      mkdocs安装
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="mkdocs安装" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        mkdocs安装
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/install/local/" title="1. 本地环境搭建(含入门配置)" class="md-nav__link">
      1. 本地环境搭建(含入门配置)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/install/github-pages/" title="2. 发布至GitHub Pages" class="md-nav__link">
      2. 发布至GitHub Pages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/install/http-server/" title="3. 发布至自己的HTTP Server" class="md-nav__link">
      3. 发布至自己的HTTP Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      mkdocs语法
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="mkdocs语法" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        mkdocs语法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/main/" title="1. 语法总览" class="md-nav__link">
      1. 语法总览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/headline/" title="2. 标题" class="md-nav__link">
      2. 标题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/paragraph/" title="3. 段落" class="md-nav__link">
      3. 段落
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/quote/" title="4. 引用" class="md-nav__link">
      4. 引用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/table/" title="5. 表格" class="md-nav__link">
      5. 表格
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-6" type="checkbox" id="nav-3-3-6">
    
    <label class="md-nav__link" for="nav-3-3-6">
      6. 代码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="6. 代码" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        6. 代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/code_inline/" title="6.1. 行内" class="md-nav__link">
      6.1. 行内
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/code_block/" title="6.2. 区块" class="md-nav__link">
      6.2. 区块
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/code_highlight/" title="6.3. 高亮" class="md-nav__link">
      6.3. 高亮
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-7" type="checkbox" id="nav-3-3-7">
    
    <label class="md-nav__link" for="nav-3-3-7">
      7. 字体样式
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="7. 字体样式" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        7. 字体样式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/font_stress/" title="7.1. 斜体,粗体,粗斜体" class="md-nav__link">
      7.1. 斜体,粗体,粗斜体
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/font_updown/" title="7.2. 上标,下标" class="md-nav__link">
      7.2. 上标,下标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/font_underline/" title="7.3. 下划线" class="md-nav__link">
      7.3. 下划线
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/font_line/" title="7.4. 横线" class="md-nav__link">
      7.4. 横线
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/font_underline_line/" title="7.5. 下划线+横线" class="md-nav__link">
      7.5. 下划线+横线
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-8" type="checkbox" id="nav-3-3-8">
    
    <label class="md-nav__link" for="nav-3-3-8">
      8. 列表
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="8. 列表" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        8. 列表
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/list_noseq/" title="8.1. 无序列表" class="md-nav__link">
      8.1. 无序列表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/list_seq/" title="8.2. 有序列表" class="md-nav__link">
      8.2. 有序列表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/list_task/" title="8.3. 任务列表" class="md-nav__link">
      8.3. 任务列表
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/cutline/" title="9. 分割线" class="md-nav__link">
      9. 分割线
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-10" type="checkbox" id="nav-3-3-10">
    
    <label class="md-nav__link" for="nav-3-3-10">
      10. 链接
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="10. 链接" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        10. 链接
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/link_normal/" title="10.1. 普通链接" class="md-nav__link">
      10.1. 普通链接
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/link_auto/" title="10.2. 自动链接" class="md-nav__link">
      10.2. 自动链接
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/link_anchor/" title="10.3. 锚点提示" class="md-nav__link">
      10.3. 锚点提示
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-11" type="checkbox" id="nav-3-3-11">
    
    <label class="md-nav__link" for="nav-3-3-11">
      11. 图片
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="11. 图片" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        11. 图片
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/image_inline/" title="11.1. 行内式" class="md-nav__link">
      11.1. 行内式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/image_index/" title="11.2. 参考式" class="md-nav__link">
      11.2. 参考式
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/escape/" title="12. 转义" class="md-nav__link">
      12. 转义
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-13" type="checkbox" id="nav-3-3-13">
    
    <label class="md-nav__link" for="nav-3-3-13">
      13. 高亮
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="13. 高亮" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-13">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        13. 高亮
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/highlight_code/" title="13.1. 代码高亮" class="md-nav__link">
      13.1. 代码高亮
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/highlight_background/" title="13.2. 背景高亮" class="md-nav__link">
      13.2. 背景高亮
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-14" type="checkbox" id="nav-3-3-14">
    
    <label class="md-nav__link" for="nav-3-3-14">
      14. 注解
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="14. 注解" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-14">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        14. 注解
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/note_main/" title="14.1. 介绍" class="md-nav__link">
      14.1. 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/note_full/" title="14.2. 完整格式" class="md-nav__link">
      14.2. 完整格式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/note_empty-title/" title="14.3. 空标题" class="md-nav__link">
      14.3. 空标题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/note_none-title/" title="14.4. 无标题" class="md-nav__link">
      14.4. 无标题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/note_none-type/" title="14.5. 无类型" class="md-nav__link">
      14.5. 无类型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/note_details/" title="14.6. 折叠" class="md-nav__link">
      14.6. 折叠
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/note_style/" title="14.7. 11种颜色样式" class="md-nav__link">
      14.7. 11种颜色样式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/note_nest/" title="14.8. 嵌套" class="md-nav__link">
      14.8. 嵌套
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/footnote/" title="15. 脚注" class="md-nav__link">
      15. 脚注
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/meta/" title="16. 元信息" class="md-nav__link">
      16. 元信息
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-17" type="checkbox" id="nav-3-3-17">
    
    <label class="md-nav__link" for="nav-3-3-17">
      17. 数学公式
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="17. 数学公式" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-17">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        17. 数学公式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/math_main/" title="17.1. 介绍" class="md-nav__link">
      17.1. 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/math_js/" title="17.2. 导入js" class="md-nav__link">
      17.2. 导入js
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/math_usage/" title="17.3. 用法" class="md-nav__link">
      17.3. 用法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-18" type="checkbox" id="nav-3-3-18">
    
    <label class="md-nav__link" for="nav-3-3-18">
      18. emoji
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="18. emoji" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-18">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        18. emoji
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/emoji_main/" title="18.1. 介绍" class="md-nav__link">
      18.1. 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/emoji_principle/" title="18.2. 工作原理" class="md-nav__link">
      18.2. 工作原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/emoji_usage/" title="18.3. 最佳实践" class="md-nav__link">
      18.3. 最佳实践
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/symbol/" title="19. 特殊符号" class="md-nav__link">
      19. 特殊符号
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3-20" type="checkbox" id="nav-3-3-20">
    
    <label class="md-nav__link" for="nav-3-3-20">
      20. 嵌套
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="20. 嵌套" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-20">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        20. 嵌套
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_main/" title="20.1. 介绍" class="md-nav__link">
      20.1. 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_note_note/" title="20.2. 注解-注解" class="md-nav__link">
      20.2. 注解-注解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_list_list/" title="20.3. 列表-列表" class="md-nav__link">
      20.3. 列表-列表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_quote_quote/" title="20.4. 引用-引用" class="md-nav__link">
      20.4. 引用-引用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_note_code/" title="20.5. 注解-代码块" class="md-nav__link">
      20.5. 注解-代码块
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_list_code/" title="20.6. 列表-代码块" class="md-nav__link">
      20.6. 列表-代码块
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_quote_code/" title="20.7. 引用-代码块" class="md-nav__link">
      20.7. 引用-代码块
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_yellow_code/" title="20.8. 黄色区块-代码" class="md-nav__link">
      20.8. 黄色区块-代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_green_code/" title="20.9. 绿色区块-代码" class="md-nav__link">
      20.9. 绿色区块-代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_red_code/" title="20.10. 红色区块-代码" class="md-nav__link">
      20.10. 红色区块-代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_greenred_code/" title="20.11. 绿接红区块-代码" class="md-nav__link">
      20.11. 绿接红区块-代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_note_list_quote/" title="20.12. 注解-列表-引用" class="md-nav__link">
      20.12. 注解-列表-引用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_list_list_quote/" title="20.13. 列表-列表-引用" class="md-nav__link">
      20.13. 列表-列表-引用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/syntax/nest_quote_quote_code/" title="20.14. 引用-引用-代码" class="md-nav__link">
      20.14. 引用-引用-代码
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      附录
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="附录" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        附录
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/pygments/" title="1. 支持代码高亮的语言" class="md-nav__link">
      1. 支持代码高亮的语言
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/emoji_shortname/" title="2. emojione全名短名映射表" class="md-nav__link">
      2. emojione全名短名映射表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/baidu_tongji/" title="3. 添加百度统计" class="md-nav__link">
      3. 添加百度统计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/color/" title="4. 配色" class="md-nav__link">
      4. 配色
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/module/" title="5. 模块介绍" class="md-nav__link">
      5. 模块介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/level/" title="6. mkdocs层级关系" class="md-nav__link">
      6. mkdocs层级关系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/search/" title="7. 支持中文搜索" class="md-nav__link">
      7. 支持中文搜索
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/yml/" title="8. mkdocs.yml范例" class="md-nav__link">
      8. mkdocs.yml范例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/tab/" title="9. tab" class="md-nav__link">
      9. tab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/appendix/chrome/" title="10. 关于chrome显示异常的问题" class="md-nav__link">
      10. 关于chrome显示异常的问题
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minikube" class="md-nav__link">
    minikube
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compatibility" class="md-nav__link">
    Compatibility
  </a>
  
    <nav class="md-nav" aria-label="Compatibility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes-compatibility-matrix" class="md-nav__link">
    Kubernetes compatibility matrix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quickstart" class="md-nav__link">
    Quickstart
  </a>
  
    <nav class="md-nav" aria-label="Quickstart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-the-dashboards" class="md-nav__link">
    Access the dashboards
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-kube-prometheus" class="md-nav__link">
    Customizing Kube-Prometheus
  </a>
  
    <nav class="md-nav" aria-label="Customizing Kube-Prometheus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compiling" class="md-nav__link">
    Compiling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-the-kube-prometheus-stack" class="md-nav__link">
    Apply the kube-prometheus stack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerized-installing-and-compiling" class="md-nav__link">
    Containerized Installing and Compiling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-from-upstream-project" class="md-nav__link">
    Update from upstream project
  </a>
  
    <nav class="md-nav" aria-label="Update from upstream project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-jb" class="md-nav__link">
    Update jb
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-kube-prometheus" class="md-nav__link">
    Update kube-prometheus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compile-the-manifests-and-apply" class="md-nav__link">
    Compile the manifests and apply
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customization-examples" class="md-nav__link">
    Customization Examples
  </a>
  
    <nav class="md-nav" aria-label="Customization Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-creation-tools" class="md-nav__link">
    Cluster Creation Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-registry" class="md-nav__link">
    Internal Registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nodeports" class="md-nav__link">
    NodePorts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-object-name" class="md-nav__link">
    Prometheus Object Name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-exporter-daemonset-namespace" class="md-nav__link">
    node-exporter DaemonSet namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alertmanager-configuration" class="md-nav__link">
    Alertmanager configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-additional-namespaces-to-monitor" class="md-nav__link">
    Adding additional namespaces to monitor
  </a>
  
    <nav class="md-nav" aria-label="Adding additional namespaces to monitor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-the-servicemonitor-for-each-additional-namespace" class="md-nav__link">
    Defining the ServiceMonitor for each additional Namespace
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-all-namespaces" class="md-nav__link">
    Monitoring all namespaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-etcd-configuration" class="md-nav__link">
    Static etcd configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod-anti-affinity" class="md-nav__link">
    Pod Anti-Affinity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stripping-container-resource-limits" class="md-nav__link">
    Stripping container resource limits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-prometheus-alertingrecording-rules-and-grafana-dashboards" class="md-nav__link">
    Customizing Prometheus alerting/recording rules and Grafana dashboards
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exposing-prometheusalermanagergrafana-via-ingress" class="md-nav__link">
    Exposing Prometheus/Alermanager/Grafana via Ingress
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#minikube-example" class="md-nav__link">
    Minikube Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continuous-delivery" class="md-nav__link">
    Continuous Delivery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-retrieving-kubelet-metrics" class="md-nav__link">
    Error retrieving kubelet metrics
  </a>
  
    <nav class="md-nav" aria-label="Error retrieving kubelet metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-problem" class="md-nav__link">
    Authentication problem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization-problem" class="md-nav__link">
    Authorization problem
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kube-state-metrics-resource-usage" class="md-nav__link">
    kube-state-metrics resource usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributing" class="md-nav__link">
    Contributing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    License
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="kube-prometheus">kube-prometheus<a class="headerlink" href="#kube-prometheus" title="Permanent link">¶</a></h1>
<blockquote>
<p>Note that everything is experimental and may change significantly at any time.</p>
</blockquote>
<p>This repository collects Kubernetes manifests, <a href="http://grafana.com/">Grafana</a> dashboards, and <a href="https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/">Prometheus rules</a> combined with documentation and scripts to provide easy to operate end-to-end Kubernetes cluster monitoring with <a href="https://prometheus.io/">Prometheus</a> using the Prometheus Operator.</p>
<p>The content of this project is written in <a href="http://jsonnet.org/">jsonnet</a>. This project could both be described as a package as well as a library.</p>
<p>Components included in this package:</p>
<ul>
<li>The <a href="https://github.com/prometheus-operator/prometheus-operator">Prometheus Operator</a></li>
<li>Highly available <a href="https://prometheus.io/">Prometheus</a></li>
<li>Highly available <a href="https://github.com/prometheus/alertmanager">Alertmanager</a></li>
<li><a href="https://github.com/prometheus/node_exporter">Prometheus node-exporter</a></li>
<li><a href="https://github.com/DirectXMan12/k8s-prometheus-adapter">Prometheus Adapter for Kubernetes Metrics APIs</a></li>
<li><a href="https://github.com/kubernetes/kube-state-metrics">kube-state-metrics</a></li>
<li><a href="https://grafana.com/">Grafana</a></li>
</ul>
<p>This stack is meant for cluster monitoring, so it is pre-configured to collect metrics from all Kubernetes components. In addition to that it delivers a default set of dashboards and alerting rules. Many of the useful dashboards and alerts come from the <a href="https://github.com/kubernetes-monitoring/kubernetes-mixin">kubernetes-mixin project</a>, similar to this project it provides composable jsonnet as a library for users to customize to their needs.</p>
<h2 id="table-of-contents">Table of contents<a class="headerlink" href="#table-of-contents" title="Permanent link">¶</a></h2>
<ul>
<li><a href="#kube-prometheus">kube-prometheus</a></li>
<li><a href="#table-of-contents">Table of contents</a></li>
<li><a href="#prerequisites">Prerequisites</a><ul>
<li><a href="#minikube">minikube</a></li>
</ul>
</li>
<li><a href="#compatibility">Compatibility</a><ul>
<li><a href="#kubernetes-compatibility-matrix">Kubernetes compatibility matrix</a></li>
</ul>
</li>
<li><a href="#quickstart">Quickstart</a><ul>
<li><a href="#access-the-dashboards">Access the dashboards</a></li>
</ul>
</li>
<li><a href="#customizing-kube-prometheus">Customizing Kube-Prometheus</a><ul>
<li><a href="#installing">Installing</a></li>
<li><a href="#compiling">Compiling</a></li>
<li><a href="#apply-the-kube-prometheus-stack">Apply the kube-prometheus stack</a></li>
<li><a href="#containerized-installing-and-compiling">Containerized Installing and Compiling</a></li>
</ul>
</li>
<li><a href="#update-from-upstream-project">Update from upstream project</a><ul>
<li><a href="#update-jb">Update jb</a></li>
<li><a href="#update-kube-prometheus">Update kube-prometheus</a></li>
<li><a href="#compile-the-manifests-and-apply">Compile the manifests and apply</a></li>
</ul>
</li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#customization-examples">Customization Examples</a><ul>
<li><a href="#cluster-creation-tools">Cluster Creation Tools</a></li>
<li><a href="#internal-registry">Internal Registry</a></li>
<li><a href="#nodeports">NodePorts</a></li>
<li><a href="#prometheus-object-name">Prometheus Object Name</a></li>
<li><a href="#node-exporter-daemonset-namespace">node-exporter DaemonSet namespace</a></li>
<li><a href="#alertmanager-configuration">Alertmanager configuration</a></li>
<li><a href="#adding-additional-namespaces-to-monitor">Adding additional namespaces to monitor</a></li>
<li><a href="#defining-the-servicemonitor-for-each-additional-namespace">Defining the ServiceMonitor for each additional Namespace</a></li>
<li><a href="#monitoring-all-namespaces">Monitoring all namespaces</a></li>
<li><a href="#static-etcd-configuration">Static etcd configuration</a></li>
<li><a href="#pod-anti-affinity">Pod Anti-Affinity</a></li>
<li><a href="#stripping-container-resource-limits">Stripping container resource limits</a></li>
<li><a href="#customizing-prometheus-alertingrecording-rules-and-grafana-dashboards">Customizing Prometheus alerting/recording rules and Grafana dashboards</a></li>
<li><a href="#exposing-prometheusalermanagergrafana-via-ingress">Exposing Prometheus/Alermanager/Grafana via Ingress</a></li>
</ul>
</li>
<li><a href="#minikube-example">Minikube Example</a></li>
<li><a href="#troubleshooting">Troubleshooting</a><ul>
<li><a href="#error-retrieving-kubelet-metrics">Error retrieving kubelet metrics</a></li>
<li><a href="#authentication-problem">Authentication problem</a></li>
<li><a href="#authorization-problem">Authorization problem</a></li>
<li><a href="#kube-state-metrics-resource-usage">kube-state-metrics resource usage</a></li>
</ul>
</li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h2>
<p>You will need a Kubernetes cluster, that's it! By default it is assumed, that the kubelet uses token authentication and authorization, as otherwise Prometheus needs a client certificate, which gives it full access to the kubelet, rather than just the metrics. Token authentication and authorization allows more fine grained and easier access control.</p>
<p>This means the kubelet configuration must contain these flags:</p>
<ul>
<li><code>--authentication-token-webhook=true</code> This flag enables, that a <code>ServiceAccount</code> token can be used to authenticate against the kubelet(s).  This can also be enabled by setting the kubelet configuration value <code>authentication.webhook.enabled</code> to <code>true</code>.</li>
<li><code>--authorization-mode=Webhook</code> This flag enables, that the kubelet will perform an RBAC request with the API to determine, whether the requesting entity (Prometheus in this case) is allowed to access a resource, in specific for this project the <code>/metrics</code> endpoint.  This can also be enabled by setting the kubelet configuration value <code>authorization.mode</code> to <code>Webhook</code>.</li>
</ul>
<p>This stack provides <a href="https://github.com/kubernetes/metrics#resource-metrics-api">resource metrics</a> by deploying the <a href="https://github.com/DirectXMan12/k8s-prometheus-adapter/">Prometheus Adapter</a>.<br />
This adapter is an Extension API Server and Kubernetes needs to be have this feature enabled, otherwise the adapter has no effect, but is still deployed.</p>
<h3 id="minikube">minikube<a class="headerlink" href="#minikube" title="Permanent link">¶</a></h3>
<p>To try out this stack, start <a href="https://github.com/kubernetes/minikube">minikube</a> with the following command:</p>
<div class="highlight"><pre><span></span><code>$ minikube delete <span class="o">&amp;&amp;</span> minikube start --kubernetes-version<span class="o">=</span>v1.20.0 --memory<span class="o">=</span>6g --bootstrapper<span class="o">=</span>kubeadm --extra-config<span class="o">=</span>kubelet.authentication-token-webhook<span class="o">=</span><span class="nb">true</span> --extra-config<span class="o">=</span>kubelet.authorization-mode<span class="o">=</span>Webhook --extra-config<span class="o">=</span>scheduler.address<span class="o">=</span><span class="m">0</span>.0.0.0 --extra-config<span class="o">=</span>controller-manager.address<span class="o">=</span><span class="m">0</span>.0.0.0
</code></pre></div>
<p>The kube-prometheus stack includes a resource metrics API server, so the metrics-server addon is not necessary. Ensure the metrics-server addon is disabled on minikube:</p>
<div class="highlight"><pre><span></span><code>$ minikube addons disable metrics-server
</code></pre></div>
<h2 id="compatibility">Compatibility<a class="headerlink" href="#compatibility" title="Permanent link">¶</a></h2>
<h3 id="kubernetes-compatibility-matrix">Kubernetes compatibility matrix<a class="headerlink" href="#kubernetes-compatibility-matrix" title="Permanent link">¶</a></h3>
<p>The following versions are supported and work as we test against these versions in their respective branches. But note that other versions might work!</p>
<table>
<thead>
<tr>
<th>kube-prometheus stack</th>
<th>Kubernetes 1.16</th>
<th>Kubernetes 1.17</th>
<th>Kubernetes 1.18</th>
<th>Kubernetes 1.19</th>
<th>Kubernetes 1.20</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>release-0.4</code></td>
<td>✔ (v1.16.5+)</td>
<td>✔</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td><code>release-0.5</code></td>
<td>✗</td>
<td>✗</td>
<td>✔</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td><code>release-0.6</code></td>
<td>✗</td>
<td>✗</td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
</tr>
<tr>
<td><code>release-0.7</code></td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><code>HEAD</code></td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✔</td>
<td>✔</td>
</tr>
</tbody>
</table>
<p>Note: Due to <a href="https://github.com/kubernetes/kubernetes/issues/83778">two</a> <a href="https://github.com/kubernetes/kubernetes/issues/86359">bugs</a> in Kubernetes v1.16.1, and prior to Kubernetes v1.16.5 the kube-prometheus release-0.4 branch only supports v1.16.5 and higher.  The <code>extension-apiserver-authentication-reader</code> role in the kube-system namespace can be manually edited to include list and watch permissions in order to workaround the second issue with Kubernetes v1.16.2 through v1.16.4.</p>
<h2 id="quickstart">Quickstart<a class="headerlink" href="#quickstart" title="Permanent link">¶</a></h2>
<blockquote>
<p>Note: For versions before Kubernetes v1.20.z refer to the <a href="#kubernetes-compatibility-matrix">Kubernetes compatibility matrix</a> in order to choose a compatible branch.</p>
</blockquote>
<p>This project is intended to be used as a library (i.e. the intent is not for you to create your own modified copy of this repository).</p>
<p>Though for a quickstart a compiled version of the Kubernetes <a href="manifests">manifests</a> generated with this library (specifically with <code>example.jsonnet</code>) is checked into this repository in order to try the content out quickly. To try out the stack un-customized run:<br />
 * Create the monitoring stack using the config in the <code>manifests</code> directory:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create the namespace and CRDs, and then wait for them to be availble before creating the remaining resources</span>
kubectl create -f manifests/setup
<span class="k">until</span> kubectl get servicemonitors --all-namespaces <span class="p">;</span> <span class="k">do</span> date<span class="p">;</span> sleep <span class="m">1</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="k">done</span>
kubectl create -f manifests/
</code></pre></div>
<p>We create the namespace and CustomResourceDefinitions first to avoid race conditions when deploying the monitoring components.<br />
Alternatively, the resources in both folders can be applied with a single command<br />
<code>kubectl create -f manifests/setup -f manifests</code>, but it may be necessary to run the command multiple times for all components to<br />
be created successfullly.</p>
<ul>
<li>And to teardown the stack:<br />
<div class="highlight"><pre><span></span><code>kubectl delete --ignore-not-found<span class="o">=</span><span class="nb">true</span> -f manifests/ -f manifests/setup
</code></pre></div></li>
</ul>
<h3 id="access-the-dashboards">Access the dashboards<a class="headerlink" href="#access-the-dashboards" title="Permanent link">¶</a></h3>
<p>Prometheus, Grafana, and Alertmanager dashboards can be accessed quickly using <code>kubectl port-forward</code> after running the quickstart via the commands below. Kubernetes 1.10 or later is required.</p>
<blockquote>
<p>Note: There are instructions on how to route to these pods behind an ingress controller in the <a href="#exposing-prometheusalermanagergrafana-via-ingress">Exposing Prometheus/Alermanager/Grafana via Ingress</a> section.</p>
</blockquote>
<p>Prometheus</p>
<div class="highlight"><pre><span></span><code>$ kubectl --namespace monitoring port-forward svc/prometheus-k8s <span class="m">9090</span>
</code></pre></div>
<p>Then access via <a href="http://localhost:9090">http://localhost:9090</a></p>
<p>Grafana</p>
<div class="highlight"><pre><span></span><code>$ kubectl --namespace monitoring port-forward svc/grafana <span class="m">3000</span>
</code></pre></div>
<p>Then access via <a href="http://localhost:3000">http://localhost:3000</a> and use the default grafana user:password of <code>admin:admin</code>.</p>
<p>Alert Manager</p>
<div class="highlight"><pre><span></span><code>$ kubectl --namespace monitoring port-forward svc/alertmanager-main <span class="m">9093</span>
</code></pre></div>
<p>Then access via <a href="http://localhost:9093">http://localhost:9093</a></p>
<h2 id="customizing-kube-prometheus">Customizing Kube-Prometheus<a class="headerlink" href="#customizing-kube-prometheus" title="Permanent link">¶</a></h2>
<p>This section:<br />
 * describes how to customize the kube-prometheus library via compiling the kube-prometheus manifests yourself (as an alternative to the <a href="#Quickstart">Quickstart section</a>).<br />
 * still doesn't require you to make a copy of this entire repository, but rather only a copy of a few select files.</p>
<h3 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link">¶</a></h3>
<p>The content of this project consists of a set of <a href="http://jsonnet.org/">jsonnet</a> files making up a library to be consumed.</p>
<p>Install this library in your own project with <a href="https://github.com/jsonnet-bundler/jsonnet-bundler#install">jsonnet-bundler</a> (the jsonnet package manager):<br />
<div class="highlight"><pre><span></span><code>$ mkdir my-kube-prometheus<span class="p">;</span> <span class="nb">cd</span> my-kube-prometheus
$ jb init  <span class="c1"># Creates the initial/empty `jsonnetfile.json`</span>
<span class="c1"># Install the kube-prometheus dependency</span>
$ jb install github.com/prometheus-operator/kube-prometheus/jsonnet/kube-prometheus@release-0.4 <span class="c1"># Creates `vendor/` &amp; `jsonnetfile.lock.json`, and fills in `jsonnetfile.json`</span>
</code></pre></div></p>
<blockquote>
<p><code>jb</code> can be installed with <code>go get github.com/jsonnet-bundler/jsonnet-bundler/cmd/jb</code></p>
<p>An e.g. of how to install a given version of this library: <code>jb install github.com/prometheus-operator/kube-prometheus/jsonnet/kube-prometheus@release-0.4</code></p>
</blockquote>
<p>In order to update the kube-prometheus dependency, simply use the jsonnet-bundler update functionality:<br />
<div class="highlight"><pre><span></span><code>$ jb update
</code></pre></div></p>
<h3 id="compiling">Compiling<a class="headerlink" href="#compiling" title="Permanent link">¶</a></h3>
<p>e.g. of how to compile the manifests: <code>./build.sh example.jsonnet</code></p>
<blockquote>
<p>before compiling, install <code>gojsontoyaml</code> tool with <code>go get github.com/brancz/gojsontoyaml</code></p>
</blockquote>
<p>Here's <a href="example.jsonnet">example.jsonnet</a>:</p>
<blockquote>
<p>Note: some of the following components must be configured beforehand. See <a href="#configuration">configuration</a> and <a href="#customization-examples">customization-examples</a>.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>local kp =
  (import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
  // Uncomment the following imports to enable its patches
  // (import &#39;kube-prometheus/kube-prometheus-anti-affinity.libsonnet&#39;) +
  // (import &#39;kube-prometheus/kube-prometheus-managed-cluster.libsonnet&#39;) +
  // (import &#39;kube-prometheus/kube-prometheus-node-ports.libsonnet&#39;) +
  // (import &#39;kube-prometheus/kube-prometheus-static-etcd.libsonnet&#39;) +
  // (import &#39;kube-prometheus/kube-prometheus-thanos-sidecar.libsonnet&#39;) +
  // (import &#39;kube-prometheus/kube-prometheus-custom-metrics.libsonnet&#39;) +
  // (import &#39;kube-prometheus/kube-prometheus-external-metrics.libsonnet&#39;) +
  {
    _config+:: {
      namespace: &#39;monitoring&#39;,
    },
  };

{ [&#39;setup/0namespace-&#39; + name]: kp.kubePrometheus[name] for name in std.objectFields(kp.kubePrometheus) } +
{
  [&#39;setup/prometheus-operator-&#39; + name]: kp.prometheusOperator[name]
  for name in std.filter((function(name) name != &#39;serviceMonitor&#39;), std.objectFields(kp.prometheusOperator))
} +
// serviceMonitor is separated so that it can be created after the CRDs are ready
{ &#39;prometheus-operator-serviceMonitor&#39;: kp.prometheusOperator.serviceMonitor } +
{ [&#39;node-exporter-&#39; + name]: kp.nodeExporter[name] for name in std.objectFields(kp.nodeExporter) } +
{ [&#39;kube-state-metrics-&#39; + name]: kp.kubeStateMetrics[name] for name in std.objectFields(kp.kubeStateMetrics) } +
{ [&#39;alertmanager-&#39; + name]: kp.alertmanager[name] for name in std.objectFields(kp.alertmanager) } +
{ [&#39;prometheus-&#39; + name]: kp.prometheus[name] for name in std.objectFields(kp.prometheus) } +
{ [&#39;prometheus-adapter-&#39; + name]: kp.prometheusAdapter[name] for name in std.objectFields(kp.prometheusAdapter) } +
{ [&#39;grafana-&#39; + name]: kp.grafana[name] for name in std.objectFields(kp.grafana) }
</code></pre></div>
<p>And here's the <a href="build.sh">build.sh</a> script (which uses <code>vendor/</code> to render all manifests in a json structure of <code>{filename: manifest-content}</code>):</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="c1"># This script uses arg $1 (name of *.jsonnet file to use) to generate the manifests/*.yaml files.</span>

<span class="nb">set</span> -e
<span class="nb">set</span> -x
<span class="c1"># only exit with zero if all commands of the pipeline exit successfully</span>
<span class="nb">set</span> -o pipefail

<span class="c1"># Make sure to use project tooling</span>
<span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/tmp/bin:</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Make sure to start with a clean &#39;manifests&#39; dir</span>
rm -rf manifests
mkdir -p manifests/setup

<span class="c1"># Calling gojsontoyaml is optional, but we would like to generate yaml, not json</span>
jsonnet -J vendor -m manifests <span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="p">-example.jsonnet</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">|</span> xargs -I<span class="o">{}</span> sh -c <span class="s1">&#39;cat {} | gojsontoyaml &gt; {}.yaml&#39;</span> -- <span class="o">{}</span>

<span class="c1"># Make sure to remove json files</span>
find manifests -type f ! -name <span class="s1">&#39;*.yaml&#39;</span> -delete
rm -f kustomization
</code></pre></div>
<blockquote>
<p>Note you need <code>jsonnet</code> (<code>go get github.com/google/go-jsonnet/cmd/jsonnet</code>) and <code>gojsontoyaml</code> (<code>go get github.com/brancz/gojsontoyaml</code>) installed to run <code>build.sh</code>. If you just want json output, not yaml, then you can skip the pipe and everything afterwards.</p>
</blockquote>
<p>This script runs the jsonnet code, then reads each key of the generated json and uses that as the file name, and writes the value of that key to that file, and converts each json manifest to yaml.</p>
<h3 id="apply-the-kube-prometheus-stack">Apply the kube-prometheus stack<a class="headerlink" href="#apply-the-kube-prometheus-stack" title="Permanent link">¶</a></h3>
<p>The previous steps (compilation) has created a bunch of manifest files in the manifest/ folder.<br />
Now simply use <code>kubectl</code> to install Prometheus and Grafana as per your configuration:</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Update the namespace and CRDs, and then wait for them to be availble before creating the remaining resources</span>
$ kubectl apply -f manifests/setup
$ kubectl apply -f manifests/
</code></pre></div><br />
Alternatively, the resources in both folders can be applied with a single command<br />
<code>kubectl apply -Rf manifests</code>, but it may be necessary to run the command multiple times for all components to<br />
be created successfullly.</p>
<p>Check the monitoring namespace (or the namespace you have specific in <code>namespace:</code>) and make sure the pods are running. Prometheus and Grafana should be up and running soon.</p>
<h3 id="containerized-installing-and-compiling">Containerized Installing and Compiling<a class="headerlink" href="#containerized-installing-and-compiling" title="Permanent link">¶</a></h3>
<p>If you don't care to have <code>jb</code> nor <code>jsonnet</code> nor <code>gojsontoyaml</code> installed, then use <code>quay.io/coreos/jsonnet-ci</code> container image. Do the following from this <code>kube-prometheus</code> directory:<br />
<div class="highlight"><pre><span></span><code>$ docker run --rm -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:<span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span> --workdir <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span> quay.io/coreos/jsonnet-ci jb update
$ docker run --rm -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:<span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span> --workdir <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span> quay.io/coreos/jsonnet-ci ./build.sh example.jsonnet
</code></pre></div></p>
<h2 id="update-from-upstream-project">Update from upstream project<a class="headerlink" href="#update-from-upstream-project" title="Permanent link">¶</a></h2>
<p>You may wish to fetch changes made on this project so they are available to you.</p>
<h3 id="update-jb">Update jb<a class="headerlink" href="#update-jb" title="Permanent link">¶</a></h3>
<p><code>jb</code> may have been updated so it's a good idea to get the latest version of this binary:</p>
<div class="highlight"><pre><span></span><code>$ go get -u github.com/jsonnet-bundler/jsonnet-bundler/cmd/jb
</code></pre></div>
<h3 id="update-kube-prometheus">Update kube-prometheus<a class="headerlink" href="#update-kube-prometheus" title="Permanent link">¶</a></h3>
<p>The command below will sync with upstream project:<br />
<div class="highlight"><pre><span></span><code>$ jb update
</code></pre></div></p>
<h3 id="compile-the-manifests-and-apply">Compile the manifests and apply<a class="headerlink" href="#compile-the-manifests-and-apply" title="Permanent link">¶</a></h3>
<p>Once updated, just follow the instructions under "Compiling" and "Apply the kube-prometheus stack" to apply the changes to your cluster.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">¶</a></h2>
<p>Jsonnet has the concept of hidden fields. These are fields, that are not going to be rendered in a result. This is used to configure the kube-prometheus components in jsonnet. In the example jsonnet code of the above <a href="#customizing-kube-prometheus">Customizing Kube-Prometheus section</a>, you can see an example of this, where the <code>namespace</code> is being configured to be <code>monitoring</code>. In order to not override the whole object, use the <code>+::</code> construct of jsonnet, to merge objects, this way you can override individual settings, but retain all other settings and defaults.</p>
<p>These are the available fields with their respective default values:<br />
<div class="highlight"><pre><span></span><code>{
    _config+:: {
    namespace: &quot;default&quot;,

    versions+:: {
        alertmanager: &quot;v0.17.0&quot;,
        nodeExporter: &quot;v0.18.1&quot;,
        kubeStateMetrics: &quot;v1.5.0&quot;,
        kubeRbacProxy: &quot;v0.4.1&quot;,
        prometheusOperator: &quot;v0.30.0&quot;,
        prometheus: &quot;v2.10.0&quot;,
    },

    imageRepos+:: {
        prometheus: &quot;quay.io/prometheus/prometheus&quot;,
        alertmanager: &quot;quay.io/prometheus/alertmanager&quot;,
        kubeStateMetrics: &quot;quay.io/coreos/kube-state-metrics&quot;,
        kubeRbacProxy: &quot;quay.io/brancz/kube-rbac-proxy&quot;,
        nodeExporter: &quot;quay.io/prometheus/node-exporter&quot;,
        prometheusOperator: &quot;quay.io/prometheus-operator/prometheus-operator&quot;,
    },

    prometheus+:: {
        names: &#39;k8s&#39;,
        replicas: 2,
        rules: {},
    },

    alertmanager+:: {
      name: &#39;main&#39;,
      config: |||
        global:
          resolve_timeout: 5m
        route:
          group_by: [&#39;job&#39;]
          group_wait: 30s
          group_interval: 5m
          repeat_interval: 12h
          receiver: &#39;null&#39;
          routes:
          - match:
              alertname: Watchdog
            receiver: &#39;null&#39;
        receivers:
        - name: &#39;null&#39;
      |||,
      replicas: 3,
    },

    kubeStateMetrics+:: {
      collectors: &#39;&#39;,  // empty string gets a default set
      scrapeInterval: &#39;30s&#39;,
      scrapeTimeout: &#39;30s&#39;,

      baseCPU: &#39;100m&#39;,
      baseMemory: &#39;150Mi&#39;,
    },

    nodeExporter+:: {
      port: 9100,
    },
    },
}
</code></pre></div></p>
<p>The grafana definition is located in a different project (<a href="https://github.com/brancz/kubernetes-grafana">https://github.com/brancz/kubernetes-grafana</a>), but needed configuration can be customized from the same top level <code>_config</code> field. For example to allow anonymous access to grafana, add the following <code>_config</code> section:<br />
<div class="highlight"><pre><span></span><code>      grafana+:: {
        config: { // http://docs.grafana.org/installation/configuration/
          sections: {
            &quot;auth.anonymous&quot;: {enabled: true},
          },
        },
      },
</code></pre></div></p>
<h2 id="customization-examples">Customization Examples<a class="headerlink" href="#customization-examples" title="Permanent link">¶</a></h2>
<p>Jsonnet is a turing complete language, any logic can be reflected in it. It also has powerful merge functionalities, allowing sophisticated customizations of any kind simply by merging it into the object the library provides.</p>
<h3 id="cluster-creation-tools">Cluster Creation Tools<a class="headerlink" href="#cluster-creation-tools" title="Permanent link">¶</a></h3>
<p>A common example is that not all Kubernetes clusters are created exactly the same way, meaning the configuration to monitor them may be slightly different. For <a href="examples/jsonnet-snippets/kubeadm.jsonnet">kubeadm</a>, <a href="examples/jsonnet-snippets/bootkube.jsonnet">bootkube</a>, <a href="examples/jsonnet-snippets/kops.jsonnet">kops</a> and <a href="examples/jsonnet-snippets/kubespray.jsonnet">kubespray</a> clusters there are mixins available to easily configure these:</p>
<p>kubeadm:</p>
<div class="highlight"><pre><span></span><code>(import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
(import &#39;kube-prometheus/kube-prometheus-kubeadm.libsonnet&#39;)
</code></pre></div>
<p>bootkube:</p>
<div class="highlight"><pre><span></span><code>(import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
(import &#39;kube-prometheus/kube-prometheus-bootkube.libsonnet&#39;)
</code></pre></div>
<p>kops:</p>
<div class="highlight"><pre><span></span><code>(import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
(import &#39;kube-prometheus/kube-prometheus-kops.libsonnet&#39;)
</code></pre></div>
<p>kops with CoreDNS:</p>
<p>If your kops cluster is using CoreDNS, there is an additional mixin to import.</p>
<div class="highlight"><pre><span></span><code>(import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
(import &#39;kube-prometheus/kube-prometheus-kops.libsonnet&#39;) +
(import &#39;kube-prometheus/kube-prometheus-kops-coredns.libsonnet&#39;)
</code></pre></div>
<p>kubespray:</p>
<div class="highlight"><pre><span></span><code>(import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
(import &#39;kube-prometheus/kube-prometheus-kubespray.libsonnet&#39;)
</code></pre></div>
<p>kube-aws:</p>
<div class="highlight"><pre><span></span><code>(import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
(import &#39;kube-prometheus/kube-prometheus-kube-aws.libsonnet&#39;)
</code></pre></div>
<h3 id="internal-registry">Internal Registry<a class="headerlink" href="#internal-registry" title="Permanent link">¶</a></h3>
<p>Some Kubernetes installations source all their images from an internal registry. kube-prometheus supports this use case and helps the user synchronize every image it uses to the internal registry and generate manifests pointing at the internal registry.</p>
<p>To produce the <code>docker pull/tag/push</code> commands that will synchronize upstream images to <code>internal-registry.com/organization</code> (after having run the <code>jb</code> command to populate the vendor directory):</p>
<div class="highlight"><pre><span></span><code>$ jsonnet -J vendor -S --tla-str <span class="nv">repository</span><span class="o">=</span>internal-registry.com/organization sync-to-internal-registry.jsonnet
$ docker pull k8s.gcr.io/addon-resizer:1.8.4
$ docker tag k8s.gcr.io/addon-resizer:1.8.4 internal-registry.com/organization/addon-resizer:1.8.4
$ docker push internal-registry.com/organization/addon-resizer:1.8.4
$ docker pull quay.io/prometheus/alertmanager:v0.16.2
$ docker tag quay.io/prometheus/alertmanager:v0.16.2 internal-registry.com/organization/alertmanager:v0.16.2
$ docker push internal-registry.com/organization/alertmanager:v0.16.2
...
</code></pre></div>
<p>The output of this command can be piped to a shell to be executed by appending <code>| sh</code>.</p>
<p>Then to generate manifests with <code>internal-registry.com/organization</code>, use the <code>withImageRepository</code> mixin:</p>
<div class="highlight"><pre><span></span><code>local mixin = import &#39;kube-prometheus/kube-prometheus-config-mixins.libsonnet&#39;;
local kp = (import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) + {
  _config+:: {
    namespace: &#39;monitoring&#39;,
  },
} + mixin.withImageRepository(&#39;internal-registry.com/organization&#39;);

{ [&#39;00namespace-&#39; + name]: kp.kubePrometheus[name] for name in std.objectFields(kp.kubePrometheus) } +
{ [&#39;0prometheus-operator-&#39; + name]: kp.prometheusOperator[name] for name in std.objectFields(kp.prometheusOperator) } +
{ [&#39;node-exporter-&#39; + name]: kp.nodeExporter[name] for name in std.objectFields(kp.nodeExporter) } +
{ [&#39;kube-state-metrics-&#39; + name]: kp.kubeStateMetrics[name] for name in std.objectFields(kp.kubeStateMetrics) } +
{ [&#39;alertmanager-&#39; + name]: kp.alertmanager[name] for name in std.objectFields(kp.alertmanager) } +
{ [&#39;prometheus-&#39; + name]: kp.prometheus[name] for name in std.objectFields(kp.prometheus) } +
{ [&#39;grafana-&#39; + name]: kp.grafana[name] for name in std.objectFields(kp.grafana) }
</code></pre></div>
<h3 id="nodeports">NodePorts<a class="headerlink" href="#nodeports" title="Permanent link">¶</a></h3>
<p>Another mixin that may be useful for exploring the stack is to expose the UIs of Prometheus, Alertmanager and Grafana on NodePorts:</p>
<div class="highlight"><pre><span></span><code>(import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
(import &#39;kube-prometheus/kube-prometheus-node-ports.libsonnet&#39;)
</code></pre></div>
<h3 id="prometheus-object-name">Prometheus Object Name<a class="headerlink" href="#prometheus-object-name" title="Permanent link">¶</a></h3>
<p>To give another customization example, the name of the <code>Prometheus</code> object provided by this library can be overridden:</p>
<div class="highlight"><pre><span></span><code>((import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) + {
   prometheus+: {
     prometheus+: {
       metadata+: {
         name: &#39;my-name&#39;,
       },
     },
   },
 }).prometheus.prometheus
</code></pre></div>
<h3 id="node-exporter-daemonset-namespace">node-exporter DaemonSet namespace<a class="headerlink" href="#node-exporter-daemonset-namespace" title="Permanent link">¶</a></h3>
<p>Standard Kubernetes manifests are all written using <a href="https://github.com/ksonnet/ksonnet-lib/">ksonnet-lib</a>, so they can be modified with the mixins supplied by ksonnet-lib. For example to override the namespace of the node-exporter DaemonSet:</p>
<div class="highlight"><pre><span></span><code>((import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) + {
   nodeExporter+: {
     daemonset+: {
       metadata+: {
         namespace: &#39;my-custom-namespace&#39;,
       },
     },
   },
 }).nodeExporter.daemonset
</code></pre></div>
<h3 id="alertmanager-configuration">Alertmanager configuration<a class="headerlink" href="#alertmanager-configuration" title="Permanent link">¶</a></h3>
<p>The Alertmanager configuration is located in the <code>_config.alertmanager.config</code> configuration field. In order to set a custom Alertmanager configuration simply set this field.</p>
<div class="highlight"><pre><span></span><code>((import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) + {
   _config+:: {
     alertmanager+: {
       config: |||
         global:
           resolve_timeout: 10m
         route:
           group_by: [&#39;job&#39;]
           group_wait: 30s
           group_interval: 5m
           repeat_interval: 12h
           receiver: &#39;null&#39;
           routes:
           - match:
               alertname: Watchdog
             receiver: &#39;null&#39;
         receivers:
         - name: &#39;null&#39;
       |||,
     },
   },
 }).alertmanager.secret
</code></pre></div>
<p>In the above example the configuration has been inlined, but can just as well be an external file imported in jsonnet via the <code>importstr</code> function.</p>
<div class="highlight"><pre><span></span><code>((import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) + {
   _config+:: {
     alertmanager+: {
       config: importstr &#39;alertmanager-config.yaml&#39;,
     },
   },
 }).alertmanager.secret
</code></pre></div>
<h3 id="adding-additional-namespaces-to-monitor">Adding additional namespaces to monitor<a class="headerlink" href="#adding-additional-namespaces-to-monitor" title="Permanent link">¶</a></h3>
<p>In order to monitor additional namespaces, the Prometheus server requires the appropriate <code>Role</code> and <code>RoleBinding</code> to be able to discover targets from that namespace. By default the Prometheus server is limited to the three namespaces it requires: default, kube-system and the namespace you configure the stack to run in via <code>$._config.namespace</code>. This is specified in <code>$._config.prometheus.namespaces</code>, to add new namespaces to monitor, simply append the additional namespaces:</p>
<div class="highlight"><pre><span></span><code>local kp = (import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) + {
  _config+:: {
    namespace: &#39;monitoring&#39;,

    prometheus+:: {
      namespaces+: [&#39;my-namespace&#39;, &#39;my-second-namespace&#39;],
    },
  },
};

{ [&#39;00namespace-&#39; + name]: kp.kubePrometheus[name] for name in std.objectFields(kp.kubePrometheus) } +
{ [&#39;0prometheus-operator-&#39; + name]: kp.prometheusOperator[name] for name in std.objectFields(kp.prometheusOperator) } +
{ [&#39;node-exporter-&#39; + name]: kp.nodeExporter[name] for name in std.objectFields(kp.nodeExporter) } +
{ [&#39;kube-state-metrics-&#39; + name]: kp.kubeStateMetrics[name] for name in std.objectFields(kp.kubeStateMetrics) } +
{ [&#39;alertmanager-&#39; + name]: kp.alertmanager[name] for name in std.objectFields(kp.alertmanager) } +
{ [&#39;prometheus-&#39; + name]: kp.prometheus[name] for name in std.objectFields(kp.prometheus) } +
{ [&#39;grafana-&#39; + name]: kp.grafana[name] for name in std.objectFields(kp.grafana) }
</code></pre></div>
<h4 id="defining-the-servicemonitor-for-each-additional-namespace">Defining the ServiceMonitor for each additional Namespace<a class="headerlink" href="#defining-the-servicemonitor-for-each-additional-namespace" title="Permanent link">¶</a></h4>
<p>In order to Prometheus be able to discovery and scrape services inside the additional namespaces specified in previous step you need to define a ServiceMonitor resource.</p>
<blockquote>
<p>Typically it is up to the users of a namespace to provision the ServiceMonitor resource, but in case you want to generate it with the same tooling as the rest of the cluster monitoring infrastructure, this is a guide on how to achieve this.</p>
</blockquote>
<p>You can define ServiceMonitor resources in your <code>jsonnet</code> spec. See the snippet bellow:</p>
<div class="highlight"><pre><span></span><code>local kp = (import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) + {
  _config+:: {
    namespace: &#39;monitoring&#39;,
    prometheus+:: {
      namespaces+: [&#39;my-namespace&#39;, &#39;my-second-namespace&#39;],
    },
  },
  prometheus+:: {
    serviceMonitorMyNamespace: {
      apiVersion: &#39;monitoring.coreos.com/v1&#39;,
      kind: &#39;ServiceMonitor&#39;,
      metadata: {
        name: &#39;my-servicemonitor&#39;,
        namespace: &#39;my-namespace&#39;,
      },
      spec: {
        jobLabel: &#39;app&#39;,
        endpoints: [
          {
            port: &#39;http-metrics&#39;,
          },
        ],
        selector: {
          matchLabels: {
            app: &#39;myapp&#39;,
          },
        },
      },
    },
  },

};

{ [&#39;00namespace-&#39; + name]: kp.kubePrometheus[name] for name in std.objectFields(kp.kubePrometheus) } +
{ [&#39;0prometheus-operator-&#39; + name]: kp.prometheusOperator[name] for name in std.objectFields(kp.prometheusOperator) } +
{ [&#39;node-exporter-&#39; + name]: kp.nodeExporter[name] for name in std.objectFields(kp.nodeExporter) } +
{ [&#39;kube-state-metrics-&#39; + name]: kp.kubeStateMetrics[name] for name in std.objectFields(kp.kubeStateMetrics) } +
{ [&#39;alertmanager-&#39; + name]: kp.alertmanager[name] for name in std.objectFields(kp.alertmanager) } +
{ [&#39;prometheus-&#39; + name]: kp.prometheus[name] for name in std.objectFields(kp.prometheus) } +
{ [&#39;grafana-&#39; + name]: kp.grafana[name] for name in std.objectFields(kp.grafana) }
</code></pre></div>
<blockquote>
<p>NOTE: make sure your service resources have the right labels (eg. <code>'app': 'myapp'</code>) applied. Prometheus uses kubernetes labels to discover resources inside the namespaces.</p>
</blockquote>
<h3 id="monitoring-all-namespaces">Monitoring all namespaces<a class="headerlink" href="#monitoring-all-namespaces" title="Permanent link">¶</a></h3>
<p>In case you want to monitor all namespaces in a cluster, you can add the following mixin. Also, make sure to empty the namespaces defined in prometheus so that roleBindings are not created against them.  </p>
<div class="highlight"><pre><span></span><code>local kp = (import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
           (import &#39;kube-prometheus/kube-prometheus-all-namespaces.libsonnet&#39;) + {
  _config+:: {
    namespace: &#39;monitoring&#39;,

    prometheus+:: {
      namespaces: [],
    },
  },
};

{ [&#39;00namespace-&#39; + name]: kp.kubePrometheus[name] for name in std.objectFields(kp.kubePrometheus) } +
{ [&#39;0prometheus-operator-&#39; + name]: kp.prometheusOperator[name] for name in std.objectFields(kp.prometheusOperator) } +
{ [&#39;node-exporter-&#39; + name]: kp.nodeExporter[name] for name in std.objectFields(kp.nodeExporter) } +
{ [&#39;kube-state-metrics-&#39; + name]: kp.kubeStateMetrics[name] for name in std.objectFields(kp.kubeStateMetrics) } +
{ [&#39;alertmanager-&#39; + name]: kp.alertmanager[name] for name in std.objectFields(kp.alertmanager) } +
{ [&#39;prometheus-&#39; + name]: kp.prometheus[name] for name in std.objectFields(kp.prometheus) } +
{ [&#39;grafana-&#39; + name]: kp.grafana[name] for name in std.objectFields(kp.grafana) }
</code></pre></div>
<blockquote>
<p>NOTE: This configuration can potentially make your cluster insecure especially in a multi-tenant cluster. This is because this gives Prometheus visibility over the whole cluster which might not be expected in a scenario when certain namespaces are locked down for security reasons.</p>
</blockquote>
<p>Proceed with <a href="#defining-the-servicemonitor-for-each-additional-namespace">creating ServiceMonitors for the services in the namespaces</a> you actually want to monitor</p>
<h3 id="static-etcd-configuration">Static etcd configuration<a class="headerlink" href="#static-etcd-configuration" title="Permanent link">¶</a></h3>
<p>In order to configure a static etcd cluster to scrape there is a simple <a href="jsonnet/kube-prometheus/kube-prometheus-static-etcd.libsonnet">kube-prometheus-static-etcd.libsonnet</a> mixin prepared - see <a href="examples/etcd.jsonnet">etcd.jsonnet</a> for an example of how to use that mixin, and <a href="docs/monitoring-external-etcd/">Monitoring external etcd</a> for more information.</p>
<blockquote>
<p>Note that monitoring etcd in minikube is currently not possible because of how etcd is setup. (minikube's etcd binds to 127.0.0.1:2379 only, and within host networking namespace.)</p>
</blockquote>
<h3 id="pod-anti-affinity">Pod Anti-Affinity<a class="headerlink" href="#pod-anti-affinity" title="Permanent link">¶</a></h3>
<p>To prevent <code>Prometheus</code> and <code>Alertmanager</code> instances from being deployed onto the same node when<br />
possible, one can include the <a href="jsonnet/kube-prometheus/kube-prometheus-anti-affinity.libsonnet">kube-prometheus-anti-affinity.libsonnet</a> mixin:</p>
<div class="highlight"><pre><span></span><code>(import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
(import &#39;kube-prometheus/kube-prometheus-anti-affinity.libsonnet&#39;)
</code></pre></div>
<h3 id="stripping-container-resource-limits">Stripping container resource limits<a class="headerlink" href="#stripping-container-resource-limits" title="Permanent link">¶</a></h3>
<p>Sometimes in small clusters, the CPU/memory limits can get high enough for alerts to be fired continuously. To prevent this, one can strip off the predefined limits.<br />
To do that, one can import the following mixin</p>
<div class="highlight"><pre><span></span><code>local kp = (import &#39;kube-prometheus/kube-prometheus.libsonnet&#39;) +
           (import &#39;kube-prometheus/kube-prometheus-strip-limits.libsonnet&#39;) + {
  _config+:: {
    namespace: &#39;monitoring&#39;,
  },
};

{ [&#39;00namespace-&#39; + name]: kp.kubePrometheus[name] for name in std.objectFields(kp.kubePrometheus) } +
{ [&#39;0prometheus-operator-&#39; + name]: kp.prometheusOperator[name] for name in std.objectFields(kp.prometheusOperator) } +
{ [&#39;node-exporter-&#39; + name]: kp.nodeExporter[name] for name in std.objectFields(kp.nodeExporter) } +
{ [&#39;kube-state-metrics-&#39; + name]: kp.kubeStateMetrics[name] for name in std.objectFields(kp.kubeStateMetrics) } +
{ [&#39;alertmanager-&#39; + name]: kp.alertmanager[name] for name in std.objectFields(kp.alertmanager) } +
{ [&#39;prometheus-&#39; + name]: kp.prometheus[name] for name in std.objectFields(kp.prometheus) } +
{ [&#39;grafana-&#39; + name]: kp.grafana[name] for name in std.objectFields(kp.grafana) }
</code></pre></div>
<h3 id="customizing-prometheus-alertingrecording-rules-and-grafana-dashboards">Customizing Prometheus alerting/recording rules and Grafana dashboards<a class="headerlink" href="#customizing-prometheus-alertingrecording-rules-and-grafana-dashboards" title="Permanent link">¶</a></h3>
<p>See <a href="docs/developing-prometheus-rules-and-grafana-dashboards/">developing Prometheus rules and Grafana dashboards</a> guide.</p>
<h3 id="exposing-prometheusalermanagergrafana-via-ingress">Exposing Prometheus/Alermanager/Grafana via Ingress<a class="headerlink" href="#exposing-prometheusalermanagergrafana-via-ingress" title="Permanent link">¶</a></h3>
<p>See <a href="docs/exposing-prometheus-alertmanager-grafana-ingress/">exposing Prometheus/Alertmanager/Grafana</a> guide.</p>
<h2 id="minikube-example">Minikube Example<a class="headerlink" href="#minikube-example" title="Permanent link">¶</a></h2>
<p>To use an easy to reproduce example, see <a href="examples/minikube.jsonnet">minikube.jsonnet</a>, which uses the minikube setup as demonstrated in <a href="#prerequisites">Prerequisites</a>. Because we would like easy access to our Prometheus, Alertmanager and Grafana UIs, <code>minikube.jsonnet</code> exposes the services as NodePort type services.</p>
<h2 id="continuous-delivery">Continuous Delivery<a class="headerlink" href="#continuous-delivery" title="Permanent link">¶</a></h2>
<p>Working examples of use with continuous delivery tools are found in examples/continuous-delivery.</p>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">¶</a></h2>
<p>See the general <a href="docs/community-support/">guidelines</a> for getting support from the community.</p>
<h3 id="error-retrieving-kubelet-metrics">Error retrieving kubelet metrics<a class="headerlink" href="#error-retrieving-kubelet-metrics" title="Permanent link">¶</a></h3>
<p>Should the Prometheus <code>/targets</code> page show kubelet targets, but not able to successfully scrape the metrics, then most likely it is a problem with the authentication and authorization setup of the kubelets.</p>
<p>As described in the <a href="#prerequisites">Prerequisites</a> section, in order to retrieve metrics from the kubelet token authentication and authorization must be enabled. Some Kubernetes setup tools do not enable this by default.</p>
<ul>
<li>If you are using Google's GKE product, see <a href="docs/GKE-cadvisor-support/">cAdvisor support</a>.</li>
<li>If you are using AWS EKS, see <a href="docs/EKS-cni-support/">AWS EKS CNI support</a>.</li>
<li>If you are using Weave Net, see <a href="docs/weave-net-support/">Weave Net support</a>.</li>
</ul>
<h4 id="authentication-problem">Authentication problem<a class="headerlink" href="#authentication-problem" title="Permanent link">¶</a></h4>
<p>The Prometheus <code>/targets</code> page will show the kubelet job with the error <code>403 Unauthorized</code>, when token authentication is not enabled. Ensure, that the <code>--authentication-token-webhook=true</code> flag is enabled on all kubelet configurations.</p>
<h4 id="authorization-problem">Authorization problem<a class="headerlink" href="#authorization-problem" title="Permanent link">¶</a></h4>
<p>The Prometheus <code>/targets</code> page will show the kubelet job with the error <code>401 Unauthorized</code>, when token authorization is not enabled. Ensure that the <code>--authorization-mode=Webhook</code> flag is enabled on all kubelet configurations.</p>
<h3 id="kube-state-metrics-resource-usage">kube-state-metrics resource usage<a class="headerlink" href="#kube-state-metrics-resource-usage" title="Permanent link">¶</a></h3>
<p>In some environments, kube-state-metrics may need additional<br />
resources. One driver for more resource needs, is a high number of<br />
namespaces. There may be others.</p>
<p>kube-state-metrics resource allocation is managed by<br />
<a href="https://github.com/kubernetes/autoscaler/tree/master/addon-resizer/nanny">addon-resizer</a><br />
You can control it's parameters by setting variables in the<br />
config. They default to:</p>
<div class="highlight"><pre><span></span><code>    kubeStateMetrics+:: {
      baseCPU: &#39;100m&#39;,
      cpuPerNode: &#39;2m&#39;,
      baseMemory: &#39;150Mi&#39;,
      memoryPerNode: &#39;30Mi&#39;,
    }
</code></pre></div>
<h2 id="contributing">Contributing<a class="headerlink" href="#contributing" title="Permanent link">¶</a></h2>
<p>All <code>.yaml</code> files in the <code>/manifests</code> folder are generated via<br />
<a href="https://jsonnet.org/">Jsonnet</a>. Contributing changes will most likely include<br />
the following process:</p>
<ol>
<li>Make your changes in the respective <code>*.jsonnet</code> file.</li>
<li>Commit your changes (This is currently necessary due to our vendoring<br />
   process. This is likely to change in the future).</li>
<li>Update the pinned kube-prometheus dependency in <code>jsonnetfile.lock.json</code>: <code>jb update</code></li>
<li>Generate dependent <code>*.yaml</code> files: <code>make generate</code></li>
<li>Commit the generated changes.</li>
</ol>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link">¶</a></h2>
<p>Apache License 2.0, see <a href="https://github.com/prometheus-operator/kube-prometheus/blob/master/LICENSE">LICENSE</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["navigation.expand", "tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>